#!/usr/bin/env bash

#watch fuser fdisk dd fsck r2 parallel

# ======================================== Rules =========================================
# Use as ${tmp_}/0 as final output file
# Use "${}" "$""" "$num"
# Use single ticks with sed and awk (don't why it understands it)
# Use "${ Var }" 	when EXPANSION NEEDED			in SHELL
# Use "$Var"		when EXPANSION NOT NEEDED
# Use '$""'		when SUBSTITUTING STDIN			in AWK and SED
# Use single ticks when 
#			NO RUN TIME SUBSTITUTION EXIST in Quotes
#			Quotes DO NOT have other single ticks
# Use double ticks when 
#			RUN TIME SUBSTITUTION EXIST in Quotes
#			Quotes HAVE ANY single ticks
# Inside Double ticks		
#			LEAVE ACTIVE RUNTIME SUBSTITUTION 	${ charVar_ }
#			ESCAPE UNWANTED SUBSTITUTION		\${ charVar }, some ${ integerVar }	
#			ESCAPE unwanted Quote terminations	"\"\""
# ${ intVar } are
#			inherited from USER INPUT
#			inherited by sed and awk like ${0}
# ${ charVar_ } are 
#			ACTIVE runtime substitution variables
# ${ charVar } are 
#			inherited substitution from USER INPUT or ANOTHER FUNCTION or LOOP
#			PASSIVE substitution variables
# Before >| or >>
#			check if configuration exists
#	-CAUTION- -OR-	check the number of lines in that file and DELETE ALL LINES after last line
# Double Escape \\ before new-line character

# =============================== DIRECTORIES =======================================

#mkdir /git/mine		2>| /dev/null ; echo -n $?

ls /tmp/files		1>| /dev/zero 2>&1 || 	mkdir /tmp/files 	
ls /root/tmp		1>| /dev/zero 2>&1 || 	mkdir /root/tmp 	

ls /root/git/dotfile	1>| /dev/null 2>&1 || 
	git clone https://github.com/GypsyCosmonaut/main.git		/root/git

ls /root/git/web	1>| /dev/null 2>&1 || 
	git clone https://github.com/GypsyCosmonaut/web.git 		/root/git

# =============================== EXECUTABLES =======================================

chmod +x /root/git/dotfile/all

# ==============================RUNTIME SUBSTITUTIONS================================
# function to list runtime substitutions here

tmp_=/tmp/files
si_="sed -i"
se_="sed -e"
gq_="grep -q"
gs_="gsettings set"
og_="org.gnome"
all_="/root/git/dotfile/all"

echo
(${gq_} earth /etc/hostname) || (
	echo earth 1>| /etc/hostname && 
	${si_} '2s/.*/127.0.1.1    earth/' /etc/hosts 
	)
	
(${gq_} groot 0< /etc/passwd) 	|| (
	echo 'promt for root' && 
	passwd root
	)
	
(${gq_} groot 0< /etc/passwd) 	|| (
	useradd --create-home groot && 
	${si_} '/groot/s/$/\/bin\/bash/' /etc/passwd && 
	echo 'promt for groot' && 
	passwd groot
	)
# ================================= SUDOERS ========================================

(${gq_} groot 0< /etc/sudoers) 	||
	echo "groot	ALL=(ALL:ALL) ALL" 		>> /etc/sudoers


# ================================ CONFIGURATIONS =======================================
# function to list all gsettings here

git config --global user.name GypsyCosmonaut
git config --global user.email rahulbansal1913@gmail.com
git config --global branch.autosetuprebase always
git config --global color.ui true
git config --global color.status auto
git config --global color.branch auto
git config --global core.editor gedit
git config --global credential.helper store
#git config --global merge.tool vimdiff

#"${si_}" 's/\(^#\)\([\t ]\+\)\(NONE\|art\|gif\|jpg\|png\|bmp\|tif\|avi\|mov\|mpg\|fws\|doc\|pst\|ost\|dbx\|idx\|mbx\|wpc\|htm\|pdf\|mail\|pgd\|pgp\|txt\|rpm\|wav\|ra\|dat\|zip\|java\|max\|pins\)\([\t ]\+\)\(n\|y\)\([\t ]\+\)\(.*\)/\2\3\4\5\6\7/'		/etc/scalpel/scalpel.conf

${si_} 's/\(^#\)\(\t\+\|\s\+\|\s\+\t\+\|\t\+\s\+\)\(NONE\|art\|gif\|jpg\|png\|bmp\|tif\|avi\|mov\|mpg\|fws\|doc\|pst\|ost\|dbx\|idx\|mbx\|wpc\|htm\|pdf\|mail\|pgd\|pgp\|txt\|rpm\|wav\|ra\|dat\|zip\|java\|max\|pins\)\(\t\+\|\s\+\|\s\+\t\+\|\t\+\s\+\)\(n\|y\)\(\t\+\|\s\+\|\s\+\t\+\|\t\+\s\+\)\(.*\)/\2\3\4\5\6\7/' 							/etc/scalpel/scalpel.conf

${si_} 's/.*\(AutomaticLoginEnable \).*/\1= true/' 	/etc/gdm3/daemon.conf
${si_} 's/.*\(AutomaticLogin \).*/\1= root/' 		/etc/gdm3/daemon.conf
${si_} 's/LEFT/RIGHT/'				/etc/dconf/db/local.d/kali-tweaks
${si_} 's/\(size=\)32/\120/' 				/etc/dconf/db/local.d/kali-tweaks
${si_} 's/\(shrink=\)true/\1false/' 			/etc/dconf/db/local.d/kali-tweaks
${si_} 's/\(opacity=\)0/\1100/' 			/etc/dconf/db/local.d/kali-tweaks
${si_} 's/.*\(opacity\).*/background-\1=0/'		/etc/dconf/db/local.d/kali-tweaks


gconvert() {
	g_path_=$(echo ${g_schema_} | sed 'y|.|/|; s|$|/|; s|^|/|; s|\(.*\)|\L\1|')
	schema_path_=${g_schema_}:${g_path_}
}

g_schema_=${og_}.Terminal.Legacy.Keybindings
gconvert ;

${gs_} ${schema_path_} new-window '<Control>n'
${gs_} ${schema_path_} new-tab '<Control>t'
${gs_} ${schema_path_} close-tab '<Ctrl>w'
${gs_} ${schema_path_} next-tab '<Primary>Right'
${gs_} ${schema_path_} prev-tab '<Primary>Left'
${gs_} ${schema_path_} full-screen '<Ctrl>f'

#"${gs_}" "${og_}".desktop.default-applications.terminal exec terminator

${gs_} ${og_}.Terminal.Legacy.Settings theme-variant 'dark'
${gs_} ${og_}.desktop.lockdown disable-lock-screen true
${gs_} ${og_}.shell.extensions.workspaces-to-dock dock-position "'TOP'"
${gs_} ${og_}.shell.extensions.workspaces-to-dock opaque-background false
${gs_} ${og_}.shell.extensions.workspaces-to-dock require-click-to-show false
${gs_} ${og_}.shell.extensions.workspaces-to-dock thumbnail-size 0.10
${gs_} ${og_}.shell.extensions.workspaces-to-dock thumbnail-visible-width 10.0
${gs_} ${og_}.shell.extensions.workspaces-to-dock workspace-caption-height 15.0
${gs_} ${og_}.shell.extensions.workspaces-to-dock workspace-caption-taskbar-icon-size 15.0
${gs_} ${og_}.shell.extensions.workspaces-to-dock workspace-caption-windowcount-image true
${gs_} ${og_}.shell.extensions.workspaces-to-dock animation-time 0.0
${gs_} ${og_}.shell.extensions.workspaces-to-dock show-delay 0.0
${gs_} ${og_}.shell.extensions.workspaces-to-dock hide-delay 0.0
${gs_} ${og_}.shell.app-switcher current-workspace-only true
${gs_} ${og_}.desktop.wm.keybindings switch-to-workspace-left "['<Control><Shift>Left']"
${gs_} ${og_}.desktop.wm.keybindings switch-to-workspace-right "['<Control><Shift>Right']"
${gs_} ${og_}.desktop.wm.keybindings switch-windows "['<Alt>Tab']"
${gs_} ${og_}.desktop.wm.keybindings switch-windows-backward "['<Shift><Alt>Tab']"
${gs_} ${og_}.desktop.wm.keybindings switch-applications "['<Super>Tab']"
${gs_} ${og_}.desktop.wm.keybindings switch-applications-backward "['<Super><Shift>Tab']"
${gs_} ${og_}.Terminal.Legacy.Settings default-show-menubar false
${gs_} ${og_}.desktop.datetime automatic-timezone true
${gs_} ${og_}.desktop.interface clock-show-date true
${gs_} ${og_}.desktop.interface clock-show-seconds true
${gs_} ${og_}.desktop.interface show-battery-percentage true
${gs_} ${og_}.gedit.preferences.editor display-line-numbers true
${gs_} ${og_}.gedit.preferences.editor auto-indent true
${gs_} ${og_}.gedit.preferences.editor display-overview-map true
${gs_} ${og_}.gedit.preferences.editor highlight-current-line true
${gs_} ${og_}.gedit.preferences.editor auto-save true
${gs_} ${og_}.gedit.preferences.editor bracket-matching true
${gs_} ${og_}.gedit.preferences.editor scheme 'cobalt'
${gs_} ${og_}.desktop.wm.preferences audible-bell false
${gs_} ${og_}.desktop.wm.preferences visual-bell true

# ==================================ALIASES/FUNCTIONS=================================
# function to list all aliases/functions here
#cat  index.html | sed '1,61d; 210,$d; /script/d' | sed 's/^\s*\(.*\)/\1/; s/gp.insertPrx({\(.*\)});/\1/; s/"//g; s/proxy_city:,//i; s/,proxy_refs:null//i; s/,proxy_uid:null//i; s/,proxy_status:ok//i; s/,proxy_state://i; s/,/\n/; s/,/\n/2; s/,/\t\t\t\t/1; 0~1 a\\'

#cat  index.html | sed '1,61d; 210,$d; /script/d' | sed 's/^\s*\(.*\)/\1/; s/gp.insertPrx({\(.*\)});/\1/; s/"//g; s/proxy_city:,//i; s/,proxy_refs:null//i; s/,proxy_uid:null//i; s/,proxy_status:ok//i; s/,proxy_state://i; s/proxy_//gi; s/,/\n/; s/:/: /; s/:/:\t /2; s/:/:\t /4; s/,/\n/2; s/,/\t\t/; s/,/\t\t\t/; 0~1 a\\'


${si_} '100i \\n'				/root/.bashrc
${si_} '101,$d' 				/root/.bashrc

${si_} 's/#\(alias grep=\)/\1/' 		/root/.bashrc
${si_} 's/\(alias ls=\)/#\1/'			/root/.bashrc
${si_} 's/\(HISTSIZE=\)/#\1/'			/root/.bash_history
${si_} 's/\(HISTFILESIZE=\)/#\1/'		/root/.bash_history

{

	(${gq_} 'HISTFILE=' 	0< /root/.bash_history)	|| echo 'export HISTSIZE='
	(${gq_} 'HISTFILESIZE=' 0< /root/.bash_history)	|| echo 'export HISTFILESIZE='
	
} >> /root/.bash_history

(${gq_} 'set colored-stats on' 0< /etc/inputrc) || echo 'set colored-stats on'	>> /etc/inputrc


#"${gq_}" "^replace().*" 	${rc_} || echo 'replace() {} '


{
	#echo "set -o noclobber"
	
	#"${gq_}" ".* lsa=.*" 	/root/.bashrc || echo 'alias lsa =""'
	echo 'alias f="xdotool key ctrl+f"'
	echo 'alias ls="l"'
	echo 'alias pgrep="pgrep -f"'
	echo 'alias l="ls -CF --color=auto"'
	echo 'alias lv="ls -FlAshZid --color=auto"'
	echo 'alias la="ls -FlAshZi --color=auto"'	
	echo 'alias c="tput reset"'
	echo 'alias e="exit"'
	echo 'alias allout="kill -9 -1"'
	echo 'alias ct="cat -A"'
	echo 'alias iip="ip addr | grep 255"'
	echo 'alias eip="curl -s http://whatismyip.akamai.com/"'
	echo 'alias tailf="tail -f"'
	echo 'alias update="apt-get update -y && apt-get upgrade -y ;"'
	#echo "alias upgrade=\"apt-get update && apt-get upgrade && apt-get dist-upgrade ; printf '\e[?5h' ; read -p '' ; printf '\e[?5l' ;\""
	echo 'alias upgrade="apt-get update -y && apt-get upgrade -y && apt-get dist-upgrade -y ; xwd -root >|/tmp/files/a.xwd ; convert -negate /tmp/files/a.xwd /tmp/files/b.xwd ; timeout 1 xwud -in /tmp/files/b.xwd ;"'
	echo 'alias install="apt-get install"'
	echo 'alias remove="apt-get remove"'
	echo 'alias show="apt-cache show"'
	echo 'alias policy="apt-cache policy"'
	echo 'alias lcron="echo ${USER} && echo && cat /var/spool/cron/crontabs/${USER}"'
	echo 'alias rmdir="rm -r"'
	echo 'alias reload=". /root/git/dotfile/main"'
	echo 'alias rm="mv -t /tmp/files/"'
	
	echo "
	lproxy () {
		${all_} \"lproxy\"
	}"
	
	echo '
	gedit() { 
		#/root/git/dotfile/all \gedit "$@"
		nohup gedit "$@" 1> /tmp/files/nohup.out 2>&1 & 
	}'
	
	echo "
	hex() {
		cat /dev/stdin  | hexdump -v -e '\"\\\x\" 1/1 \"%02X\"' && echo ;
	}"

	echo '
	lh() {
		if [ -z "${1}" ] ;
			then
				ls -FlAshZid --color=auto .*
			else
				ls -FlAshZid --color=auto ${1}/.*
		fi
	}'

	echo '
	replace() { 
		if [ $# -eq 0 ] ; then
			echo ; echo -e "\x1B\x5B\x31\x6D\x72\x65\x70\x6C\x61\x63\x65\x3A\x20\x1B\x5B\x37\x6D\x57\x68\x65\x72\x65\x20\x57\x68\x61\x74\x20\x54\x6F\x57\x68\x61\x74\x20\x50\x61\x74\x68\x1B\x5B\x32\x37\x6D\x0A"; echo ;
			
			else
				sed -i "/${1}/s:${2}:${3}:g" ${PWD}/${4} ; 
		fi
	}'

	echo '
	lman() { 
		if [ $# -ne 0 ] ; then
			echo "^${1}$" | xargs man -k ; 
		
			else
				echo -e "\x1b[1mlman \x1b[7mUtility\x1b[27m"
		fi
	}'

	echo '
	weather() { 
		if [ $# -ne 0 ] ; then
			curl wttr.in/"^${1}$" 2>| /dev/null | 
			head -n -3 ; 
			
			else
				echo -e "\x1b[1mweather \x1b[7mPlace\x1b[27m"
		fi
	}'

	echo '
	network() { 
		iip ;
		eip ; 
		#MAC
		#apr scan, tcp scan 
		ping -c 2 google.com ; 
	}'

	echo '
	system() {
		tty ; echo ;
		iostat ; echo
		echo ${0} ; echo ;
		w ; echo ;
		who -a ; echo ;
		uptime ; echo ;
		stty -a ;
		uname -a ; echo ;
		ls -lshZid /; echo ;
		la /dev/sd[a..b] ;
		la /dev/sd[a-b][0-9] ; echo ;
		fdisk -l ; echo ;
		#du -h / ;
		df -ahT ; echo ;
		printenv ; echo ;
		cat /proc/cpuinfo ; echo;
		lscpu ; echo ;
		
	}'

	echo "
	lsd() {
		ls -AlF | 
		sort -k 9,9 >| ${tmp_}/1 ; 
	
		(
			file -Nz \"${1}\" .\"${1}\" | 
			sort -k 1,1 | 
			${se_} '/^.:.*directory$/d' -e '/^..:.*directory$/d' | 
			awk '{ \$\"1\"=\"\"; print substr(\$\"0\",2) }' | 
			tac ; 
			echo ;
		) | 
		tac >| ${tmp_}/2 ; 
		
		(
			echo; file -Nzi * .* | 
			sort -k 1,1 | 
			${se_} '1d' -e '2d' ;
		) >| ${tmp_}/3 ; 
	
		paste ${tmp_}/1 ${tmp_}/2 ${tmp_}/3 >| ${tmp_}/0 ;
		cat ${tmp_}/0 ;
	}"	
	
	echo "
	search() { 
	
		if [ \$# -ne 0 ] ; then
			apt-cache search \"\${1}\" | \\
			while read -r pkg desc; 
			do 
				apt-cache policy \"\$pkg\" | \\
				awk -v pkg=\"\$pkg\" -v desc=\"\$desc\" 'NR==2 {print pkg, desc, \$\"0\"}'; 
			done | \\
				perl -lane '
					push @e, join \$\", splice @F, -2;
					push @A, join \$\", @F;
					length(\$A[-1]) > \$maxW and \$maxW = length(\$A[-1])}{
					print \$_, \$\" x (\$maxW - length), \"\\t\", shift @e for @A;
				' ;
			
			else
				echo $'\x1B\x5B\x31\x6D\x73\x6C\x69\x73\x74\x20\x1B\x5B\x37\x6D\x55\x74\x69\x6C\x69\x74\x79\x1B\x5B\x32\x37\x6D\x0A'
		fi
	}"

	echo '
	whatis(){
		if [ $# -ne 0 ] ; then
			echo "${1}" | xargs whatis ;
			echo -e "\n \n" ;
			update-alternatives --display "${1}" 2>| /dev/null ;
		
			else
				echo -e "\x1b[1mwhat \x1b[7mUtility\x1b[27m"
		fi
	}'

	echo '
	glist() { 
		if [ $# -ne 0 ] ; then
			gsettings list-recursively | grep -i ${1} ; 
			
			else
				echo -e "\x1b[1mglist \x1b[7mKeyword\x1b[27m"
		fi
	}'	

	echo '
	grange() { 
		if [ $# -ne 0 ] ; then
			echo "*** schema = ${1} ***" ;
			echo "Type :: Key :: Value" ;
			echo "--------------------" ;
			for key in $(
				gsettings list-keys ${1} | 
				sort ;
			)
			do
				type="$(
						gsettings range ${1} ${key} | 
						tr "\n" " " ;
					)" ;
				value="$(
						gsettings get ${1} ${key} | 
						tr "\n" " " ;
					)" ;
				echo "${key} :: ${value} :: ${type}";
			done	
			
			else
				echo -e "\x1b[1mgrange \x1b[7mSchema\x1b[27m"
		fi
	}'
	
	echo '
	gitup() {
		git remote show origin ;
		git status -s ;
		echo -e "\x0a\x1b[7m\x57\x61\x6E\x74\x20\x61\x6C\x6C\x20\x63\x6F\x6D\x6D\x69\x74\x73\x20\x75\x6E\x73\x74\x61\x67\x65\x64\x20\x3F\x3F\x1b[27m\x0A"
		read r1 ;
		if echo "${r1}" | 
			grep -iq "^y" ;	then
				
			git reset ;
		fi
		echo -e "\x0a\x1b[7m\x67\x69\x74\x20\x61\x64\x64\x20\x3F\x3F\x1b[27m\x0A"
		read r1 ;
		if echo "${r1}" | 
			grep -iq "^y" ;	then
			git add . ;
		fi
		git status -s ;
		echo -e "\x0a\x1b[7m\x43\x6F\x6E\x74\x69\x6E\x75\x65\x20\x3F\x3F\x1b[27m\x0A"
		read -p "" ;
		git commit -m "0";
		#echo -e "\x0a\x1b[2m\x67\x69\x74\x20\x6C\x6F\x67\x0A"
		#git log;
		git push ;
		
	}'

} >> /root/.bashrc

. /root/.bashrc


# ================================= CRON JOBS ======================================
# function to list all cron jobs here

(${gq_} updatedb 0< /var/spool/cron/crontabs/${USER}) 	||
	{ crontab -l; echo "1 1 * * * updatedb"; } 		| crontab -

(${gq_} 'rm -rf' 0< /var/spool/cron/crontabs/${USER}) 	||
	{ crontab -l; echo "1 1	* * * rm -rf ${tmp_}/*"; } 	| crontab -

(${gq_} firefox 0< /var/spool/cron/crontabs/${USER}) 	||
	{ crontab -l; echo "1 1 * * * export DISPLAY=:0 && xhost local:"${USER}" && /usr/bin/firefox"; }							| crontab -

#{
#echo "7		5	/root/files/mega	/root/files/anacron"

#} >> /etc/anacrontab

echo -e "\x0a\x1b[7m\x57\x61\x6e\x74\x20\x55\x70\x67\x72\x61\x64\x65\x20\x3f\x3f\x1b[27m\x0a"
read r1 ;
if echo "${r1}" | 
	grep -iq "^y" ; then
	
	apt-get update -y && apt-get upgrade -y ;
	
	printf '\x0a\x1b[7m\x57\x61\x6e\x74\x20\x44\x69\x73\x74\x72\x6f\x20\x55\x70\x67\x72\x61\x64\x65\x20\x3f\x3f\x1b[27m\x0a'
	read r101
	if echo "${r101}" | 
		grep -iq "^y" ;	then 
				
		apt-get dist-upgrade -y ;
		
		echo $'\x0a\x1b[7m\x57\x61\x6E\x74\x20\x32\x46\x41\x20\x3F\x3F\x1b[27m\x0A'
		read r10101
		if echo "${r10101}" |
			grep -iq "^y" ;	then
			
			echo $'\e[33;44;1m\e[H\e[J'
			echo $'\x0a\033[1m \x1b[7m\x59\x6F\x75\x27\x72\x65\x20\x72\x65\x71\x75\x69\x72\x65\x64\x20\x74\x6F\x20\x73\x74\x61\x79\x21\x1b[27m\x0a \033[0m'
			google-authenticator ;
			echo 'auth required pam_google_authenticator.so nullok' >> /etc/pam.d/comm-auth
			#echo 'auth required pam_google_authenticator.so nullok' >> /etc/pam.d/sshd
			#"${si_}" 's/\(ChallengeResponseAuthentication \)no/\1yes/' /etc/ssh/sshd_config
			#service ssh restart
		fi
				
		printf '\x0a\x1b[7m\127\141\156\164\040\111\156\163\164\141\154\154\141\164\151\157\156\040\077\077\x1b[27m\012\012'
		read r10101;
		if echo "${r10101}" | 
			grep -iq "^y" ;	then
				
			apt-get install -y\
			tree ccrypt rotix dirmngr speedtest-cli xdotool wmctrl lshw jq ed\ 
			metagoofil \
			vega \
			i3 \
			squid3 \
			websploit \
			routersploit \
			mitmf \
			snort \
			privoxy \
			owasp-mantra-ff \
			mutt \
			iperf \
			kali-linux-web kali-linux-forensic kali-linux-full kali-linux-pwtools \
			libimage-exiftool-perl \
			libpam-google-authenticator
			empathy \
			tor gnupg2 bittorrent amule\
			strace valgrind \
			f2fs torchat fsck syncthing ssh pterm belenios-tool xbindkeys ;
			#texlive-full gedit-plugins xautomation xwd
		fi
	fi
fi

echo $'\x0a\x1b[7m\x3E\x3E\x3E\x20\x27\x72\x65\x6c\x6f\x61\x64\x27\x20\x69\x73\x20\x73\x65\x74\x1b[27m\x0a'
echo ;
echo $'\x0a\x1b[7m\x57\x61\x6e\x74\x20\x52\x65\x73\x74\x61\x72\x74\x20\x3f\x3f\x20\x1b[27m\x0a'
read r1 ;
if echo "${r1}" | 
	grep -iq "^y" ;
	
	then
		init 6 ;
	else
		wid_=$(xprop -root | 
			grep "_NET_ACTIVE_WINDOW(WINDOW)"| 
			awk '{print $5}' ;
			)
		xdotool windowfocus "${wid_}" ;
		xdotool key ctrl+t ;
		wmctrl -i -a "${wid_}" && 
		exit ;
fi
#curl -i -X GET http://rest-api.io/items
#curl -i -X GET http://rest-api.io/items/5069b47aa892630aae059584
#curl -i -X DELETE http://rest-api.io/items/5069b47aa892630aae059584
#curl -i -X POST -H 'Content-Type: application/json' -d '{"name": "New item", "year": "2009"}' http://#rest-api.io/items

#curl -i -X POST -H 'Content-Type: application/json' -d '{"name": "New item", "year": "2009"}' http://rest-api.io/items

#curl -i -X PUT -H 'Content-Type: application/json' -d '{"name": "Updated item", "year": "2010"}' #http://rest-api.io/items/5069b47aa892630aae059584


# ======================================= EOF ====================================

